<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:Veriflow.Avalonia.ViewModels"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d" d:DesignWidth="1200" d:DesignHeight="800"
        x:Class="Veriflow.Avalonia.Views.MainWindow"
        x:DataType="vm:MainViewModel"
        Icon="avares://Veriflow.Avalonia/Assets/veriflow.ico"
        Title="Veriflow Pro"
        ExtendClientAreaToDecorationsHint="True"
        ExtendClientAreaChromeHints="NoChrome"
        ExtendClientAreaTitleBarHeightHint="40"
        WindowStartupLocation="CenterScreen">

    <Design.DataContext>
        <vm:MainViewModel/>
    </Design.DataContext>

    <Window.KeyBindings>
        <!-- Global shortcut: CTRL+TAB to toggle Video/Audio profile -->
        <KeyBinding Gesture="Ctrl+Tab" Command="{Binding ToggleAudioVideoModeCommand}" />
    </Window.KeyBindings>

    <!-- Main Layout -->
    <Grid RowDefinitions="Auto, *, Auto">
        
        <!-- 1. CUSTOM TITLE BAR -->
        <Grid Grid.Row="0" Classes="ChromelessTitleBar" ColumnDefinitions="Auto, Auto, *, Auto">
            
            <!-- App Icon -->
            <Image Grid.Column="0" Classes="AppIcon" Source="avares://Veriflow.Avalonia/Assets/veriflow.ico"/>
            
            <!-- Menu Bar -->
            <Menu Grid.Column="1" Classes="TitleBarMenu">
                <MenuItem Header="File">
                    <MenuItem Header="New Session..." Command="{Binding NewSessionCommand}"/>
                    <MenuItem Header="Open Session..." Command="{Binding OpenSessionCommand}"/>
                    <Separator/>
                    <MenuItem Header="Save Session" Command="{Binding SaveSessionCommand}"/>
                    <MenuItem Header="Save Session As..." Command="{Binding SaveSessionAsCommand}"/>
                    <Separator/>
                    <MenuItem Header="Switch Workspace..." Command="{Binding SwitchWorkspaceCommand}"/>
                    <Separator/>
                    <MenuItem Header="Exit" Command="{Binding ExitCommand}"/>
                </MenuItem>
                
                <MenuItem Header="Edit">
                    <MenuItem Header="Undo" Command="{Binding UndoCommand}"/>
                    <MenuItem Header="Redo" Command="{Binding RedoCommand}"/>
                    <Separator/>
                    <MenuItem Header="Cut" Command="{Binding CutCommand}"/>
                    <MenuItem Header="Copy" Command="{Binding CopyCommand}"/>
                    <MenuItem Header="Paste" Command="{Binding PasteCommand}"/>
                    <Separator/>
                    <MenuItem Header="Preferences..." Command="{Binding OpenPreferencesCommand}"/>
                </MenuItem>
                
                <MenuItem Header="View">
                    <MenuItem Header="Media Info" ToggleType="CheckBox" IsChecked="{Binding ShowMediaInfo}"/>
                    <MenuItem Header="Waveform" ToggleType="CheckBox" IsChecked="{Binding ShowWaveform}"/>
                </MenuItem>
                
                <MenuItem Header="Help">
                    <MenuItem Header="View Help" Command="{Binding ViewHelpCommand}"/>
                    <MenuItem Header="Open Log Folder" Command="{Binding OpenLogFolderCommand}"/>
                    <Separator/>
                    <MenuItem Header="About Veriflow" Command="{Binding OpenAboutCommand}"/>
                </MenuItem>
            </Menu>

            <!-- Centered Title (Draggable) -->
            <Border Grid.Column="2" Background="Transparent" PointerPressed="TitleBar_PointerPressed">
                <TextBlock Text="{Binding ProjectTitle, FallbackValue='Veriflow Pro - Untitled Session'}" 
                           Classes="CenteredTitle"/>
            </Border>

            <!-- Window Controls -->
            <StackPanel Grid.Column="3" Orientation="Horizontal">
                <Button Classes="WindowControlButton" Command="{Binding MinimizeCommand}">
                    <TextBlock Classes="WindowControlIcon Minimize"/>
                </Button>
                <Button Classes="WindowControlButton" Command="{Binding MaximizeCommand}">
                    <TextBlock Classes="WindowControlIcon Maximize"/>
                </Button>
                <Button Classes="WindowControlButton CloseButton" Command="{Binding CloseCommand}">
                    <TextBlock Classes="WindowControlIcon Close"/>
                </Button>
            </StackPanel>
        </Grid>

        <!-- 2. CONTENT AREA -->
        <ContentControl Grid.Row="1" 
                        Content="{Binding CurrentViewModel}"
                        Background="{DynamicResource Brush.Background.Primary}"/>

        <!-- 3. FOOTER (Navigation) -->
        <Border Grid.Row="2" Background="{DynamicResource Brush.Background.Secondary}" BorderBrush="{DynamicResource Brush.Border}" BorderThickness="0,1,0,0">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="250"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="250"/>
                </Grid.ColumnDefinitions>

                <!-- Tools: A/V Switch -->
                <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center" Margin="40,0,0,0" Spacing="10">
                    <ToggleButton Classes="ViewFilter" 
                                  IsChecked="{Binding IsVideoMode}" 
                                  Command="{Binding SwitchToVideoCommand}"
                                  Background="{DynamicResource Brush.Accent.Video}"
                                  ToolTip.Tip="Switch to Video Workflow">
                        <StackPanel Orientation="Horizontal" Spacing="6" HorizontalAlignment="Center" VerticalAlignment="Center">
                            <!-- Clapperboard Icon (Filled) -->
                            <PathIcon Data="M18,4l2,4h-3l-2-4h-2l2,4h-3l-2-4H8l2,4H7L5,4H4C2.9,4,2,4.9,2,6v12c0,1.1,0.9,2,2,2h16c1.1,0,2-0.9,2-2V4H18z"
                                      Width="14" Height="14" Foreground="White" VerticalAlignment="Center"/>
                            <TextBlock Text="Video" FontSize="14" VerticalAlignment="Center"/>
                        </StackPanel>
                    </ToggleButton>
                                  
                    <ToggleButton Classes="ViewFilter" 
                                  IsChecked="{Binding IsAudioMode}" 
                                  Command="{Binding SwitchToAudioCommand}"
                                  Background="{DynamicResource Brush.Accent.Audio}"
                                  ToolTip.Tip="Switch to Audio Workflow">
                        <StackPanel Orientation="Horizontal" Spacing="6" HorizontalAlignment="Center" VerticalAlignment="Center">
                            <!-- Waveform Icon (Filled) -->
                            <PathIcon Data="M3 9h2v6H3zM7 5h2v14H7zM11 2h2v20h-2zM15 5h2v14h-2zM19 9h2v6h-2z"
                                      Width="14" Height="14" Foreground="White" VerticalAlignment="Center"/>
                            <TextBlock Text="Audio" FontSize="14" VerticalAlignment="Center"/>
                        </StackPanel>
                    </ToggleButton>
                </StackPanel>

                <!-- Navigation -->
                <StackPanel Grid.Column="1" Orientation="Horizontal" HorizontalAlignment="Center" Spacing="0">
                    <RadioButton Classes="NavButton Offload" Content="OFFLOAD" IsChecked="{Binding IsOffloadActive}" Command="{Binding ShowOffloadCommand}" GroupName="Nav"/>
                    <RadioButton Classes="NavButton Media" Content="MEDIA" IsChecked="{Binding IsMediaActive}" Command="{Binding ShowMediaCommand}" GroupName="Nav"/>
                    <RadioButton Classes="NavButton Player" Content="PLAYER" IsChecked="{Binding IsPlayerActive}" Command="{Binding ShowPlayerCommand}" GroupName="Nav"/>
                    <RadioButton Classes="NavButton Sync" Content="SYNC" IsChecked="{Binding IsSyncActive}" Command="{Binding ShowSyncCommand}" GroupName="Nav"/>
                    <RadioButton Classes="NavButton Transcode" Content="TRANSCODE" IsChecked="{Binding IsTranscodeActive}" Command="{Binding ShowTranscodeCommand}" GroupName="Nav"/>
                    <RadioButton Classes="NavButton Reports" Content="REPORTS" IsChecked="{Binding IsReportsActive}" Command="{Binding ShowReportsCommand}" GroupName="Nav"/>
                </StackPanel>

                <!-- Info -->
                <StackPanel Grid.Column="2" VerticalAlignment="Center" HorizontalAlignment="Right" Margin="0,0,20,0">
                    <TextBlock Text="Veriflow 2.0.0 (Avalonia)" Opacity="0.3" FontSize="{DynamicResource Font.Size.Small}" Foreground="{DynamicResource Brush.Text.Primary}"/>
                </StackPanel>
            </Grid>
        </Border>
        
    </Grid>
</Window>
